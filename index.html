<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Manager</title>
    <style>
        /* Previous styles remain the same */
        .debug-info {
            padding: 20px;
            background: #fff;
            margin: 20px 0;
            border-radius: 5px;
        }
        .error {
            color: red;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Order Manager</h1>
    <button onclick="loadOrders()">Refresh Orders</button>
    <div class="debug-info" id="debug"></div>
    <div class="order-container" id="orders"></div>

    <script>
        async function loadOrders() {
            const debugDiv = document.getElementById('debug');
            const ordersContainer = document.getElementById('orders');
            
            try {
                debugDiv.innerHTML = 'üîÑ Fetching directory listing...';
                ordersContainer.innerHTML = '';

                // 1. Try to get directory listing
                const dirResponse = await fetch('orders/');
                if (!dirResponse.ok) {
                    throw new Error(`Directory request failed: ${dirResponse.status} ${dirResponse.statusText}`);
                }

                // 2. Parse directory content
                const html = await dirResponse.text();
                debugDiv.innerHTML += `<br>‚úÖ Directory listing received (${html.length} bytes)`;
                
                // 3. Extract JSON files
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const links = [...doc.querySelectorAll('a')];
                const jsonFiles = links
                    .filter(a => a.href.endsWith('.json'))
                    .map(a => a.href.split('/').pop());

                debugDiv.innerHTML += `<br>üìÅ Found ${jsonFiles.length} JSON files: ${jsonFiles.join(', ')}`;

                if (jsonFiles.length === 0) {
                    throw new Error('No JSON files found in orders directory');
                }

                // 4. Load and display orders
                for (const file of jsonFiles) {
                    try {
                        debugDiv.innerHTML += `<br>üîç Loading: ${file}...`;
                        const orderResponse = await fetch(`orders/${file}`);
                        
                        if (!orderResponse.ok) {
                            throw new Error(`Failed to load ${file}: ${orderResponse.status}`);
                        }
                        
                        const order = await orderResponse.json();
                        debugDiv.innerHTML += `<br>‚úÖ Loaded ${order.orderId}`;

                        // Create order card
                        const orderCard = document.createElement('div');
                        orderCard.className = 'order-card';
                        orderCard.innerHTML = `
                            <h3>${order.orderId}</h3>
                            <p>Date: ${order.orderDate}</p>
                            <div>Items:
                                <ul>
                                    ${order.items.map(item => `
                                        <li>${item.name} (x${item.quantity}) - $${item.price}</li>
                                    `).join('')}
                                </ul>
                            </div>
                            <p>Total: $${order.total.toFixed(2)}</p>
                            <p>Delivery: ${order.deliveryTime}</p>
                            <div class="status ${order.status.toLowerCase().includes('paid') ? 'paid' : 'pending'}">
                                ${order.status}
                            </div>
                        `;
                        ordersContainer.appendChild(orderCard);
                    } catch (fileError) {
                        debugDiv.innerHTML += `<br>‚ùå Error with ${file}: ${fileError.message}`;
                    }
                }

            } catch (error) {
                debugDiv.innerHTML += `<br><div class="error">‚ùå Critical Error: ${error.message}</div>`;
                console.error('Error:', error);
            }
        }

        // Initial load
        loadOrders();
    </script>
</body>
</html>
